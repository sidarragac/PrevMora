
name: Lint Backend
on:
  workflow_dispatch: {}
  pull_request:
    paths: ["backend/**", ".github/workflows/**"]
  push:
    branches: [ main, develop ]
    paths: ["backend/**", ".github/workflows/**"]

jobs:
  lint:
    runs-on: ubuntu-latest
    defaults: { run: { shell: bash, working-directory: backend } }
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
          cache-dependency-path: |
            backend/requirements.txt
            backend/requirements-dev.txt
            backend/pyproject.toml

      - name: Install deps (project + linters)
        run: |
          python -m pip install --upgrade pip
          [[ -f requirements.txt ]] && pip install -r requirements.txt
          [[ -f requirements-dev.txt ]] && pip install -r requirements-dev.txt
          [[ -f pyproject.toml ]] && pip install .
          # Asegura linters aunque no est√©n en tus archivos
          pip install "black==24.8.0" "isort==5.13.2" "ruff==0.6.9" "pylint==3.2.6" "flake8==7.1.1"

      - name: Black
        run: black --check --diff .
      - name: isort
        run: isort --check-only --df .
      - name: Ruff (opcional)
        run: ruff check . || true
      - name: Pylint
        run: |
          TARGETS="."
          [[ -d app ]] && TARGETS="app"
          [[ -d src ]] && TARGETS="src"
          [[ -d credit_management ]] && TARGETS="credit_management"
          pylint $TARGETS
      - name: Flake8 (opcional)
        run: flake8 . || true
